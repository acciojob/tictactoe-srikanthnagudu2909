<!DOCTYPE html>
<html>

<head>
    <title>Tic Tac Toe</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hide {
            display: none;
        }

        .game-board {
            height: 400px;
            width: 400px;
            border: 1px solid black;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr)
        }

        .box {
            border: 1px solid black;
            background-color: rgb(230, 175, 184);

            font-size: xx-large;
            text-align: center;
            align-content: center;
            transition: background 1s ease 2s;
        }
    </style>
</head>

<body>
    <form id="player-form" class="">
        <label for="player-1">Player 1 </label>
        <input type="text" id="player-1">
        <label for="player-2">Player 2 </label>
        <input type="text" id="player-2">
        <input type="submit" value="submit">
    </form>

    <div class="hide" id="game-area">
        <h1 id="player-turn-info"></h1>
        <div class="game-board hide" id="game-board">
        </div>
    </div>

    <script>
        let isPlayerOneTurn = true
        const playerTurnInfo = document.getElementById("player-turn-info")
        const form = document.getElementById("player-form")
        const gameBoard = document.getElementById("game-board")
        const gameArea = document.getElementById("game-area")

        const playerOneSelections = []
        const playerTwoSelections = []

        const winningCombinations = [
            // Row
            ['R1-C1', 'R1-C2', 'R1-C3'],// ['R1-C1','R2-C2','R2-C3','R1-C2']
            ['R2-C1', 'R2-C2', 'R2-C3'],
            ['R3-C1', 'R3-C2', 'R3-C3'],
            // Column
            ['R1-C1', 'R2-C1', 'R3-C1'],
            ['R1-C2', 'R2-C2', 'R3-C2'],
            ['R1-C3', 'R2-C3', 'R3-C3'],
            // Diagonal
            ['R1-C1', 'R2-C2', 'R3-C3'],
            ['R1-C3', 'R2-C2', 'R3-C1']

        ]

        form.addEventListener("submit", storePlayerDetails)


        // Create Row and Column boxes in grid

        function createBoxes(id, i) {
            const box = document.createElement("div")
            box.classList.add("box")
            box.id = id
            box.addEventListener("click", plyaerTurn)


            // Scratch boxes if won
            // if(i<=3){
            //     const line = document.createElement("div")
            //     line.style.height = '2px'
            //     line.style.width = "100%"
            //     line.style.backgroundColor = "black"

            //     box.appendChild(line)
            // }


            // box.id = id
            gameBoard.appendChild(box)
        }


        let row = 1;
        let column = 1;

        for (let i = 1; i <= 9; i++) {
            const id = `R${row}-C${column}`

            if (i % 3 === 0) {
                row++
                column = 0
            }


            createBoxes(id, i)
            column++
        }



        // Player turn
        function plyaerTurn(e) {
            console.log("plyaer clicked the box", e.target.id)

            e.target.style.backgroundColor = `rgb(238, 199, 300)`

            // If box already clicked then do nothing/return
            if (e.target.innerText) return



            if (isPlayerOneTurn) {
                e.target.innerText = "X"
                isPlayerOneTurn = false
                playerTurnInfo.innerText = `Its ${localStorage.getItem("player2")}'s turn!!!`
                playerOneSelections.push(e.target.id)
            } else {
                e.target.innerText = "O"
                isPlayerOneTurn = true
                playerTurnInfo.innerText = `Its ${localStorage.getItem("player1")}'s turn!!!`
                playerTwoSelections.push(e.target.id)

            }

            if (playerOneSelections.length >= 3 || playerTwoSelections.length >= 3) {
                findWinner()
            }

            console.log(playerOneSelections, playerTwoSelections)
        }


        // Identify the winner
        function findWinner() {

            console.log("trying to find winner")

            // let winner = ""

            // Find if player 1 is winner
            if (playerOneSelections.length >= 3) {
                for (let combo of winningCombinations) {

                    let count = 0
                    // combo is ['R1-C1','R1-C2','R1-C3']
                    for (let i = 0; i < combo.length; i++) {
                        // combo[i] // R1-C1

                        if (playerOneSelections.includes(combo[i])) {
                            count++
                        }


                    }

                    if (count === 3) {
                        console.log(combo, 'combination for boxes')

                        playerTurnInfo.innerText = `${localStorage.getItem("player1")} is winner!!!!!`

                        return
                    }

                }

            }

            // Find if player 2 is winner
            if (playerTwoSelections.length >= 3) {
                for (let combo of winningCombinations) {

                    let count = 0
                    // combo is ['R1-C1','R1-C2','R1-C3']
                    for (let i = 0; i < combo.length; i++) {
                        // combo[i] // R1-C1

                        if (playerTwoSelections.includes(combo[i])) {
                            count++
                        }


                    }

                    if (count === 3) {
                        console.log(combo, 'combination for boxes')

                        playerTurnInfo.innerText = `${localStorage.getItem("player2")} is winner!!!!!`

                        return
                    }

                }

            }


        }


        // Store player details in local storage
        function storePlayerDetails(e) {
            e.preventDefault()
            const form = e.target
            const player1 = form[0].value;
            const player2 = form[1].value;

            localStorage.setItem("player1", player1)
            localStorage.setItem("player2", player2)


            form.classList.toggle("hide")
            gameArea.classList.toggle("hide")

            playerTurnInfo.innerText = `Its ${player1}'s turn!!!`

            console.log(e, form, player1, 'event in form')





        }
    </script>
</body>

</html>